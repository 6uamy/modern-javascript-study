# 23장 실행 컨텍스트

### 1. 소스코드의 타입

소스코드에 타입에 따라 실행 컨텍스트를 생성하는 과정과 관리 내용이 다르다.

- **전역 코드**

  전역에 존재하는 소스코드(함수, 클래스 등의 내부 블럭은 포함하지 않음)

- **함수 코드**
  함수 내부에 존재하는 소스코드
- **eval 코드**
  빌트입 전역함수인 eval 함수에 인수로 전달되어 실행되는 소스코드
- **모듈 코드**
  모듈 내부에 존재하는 소스코드

### 2. 소스코드의 평가와 실행

소스코드 평가 과정 → 실행컨텍스트 생성 후 변수, 함수 등 선언문을 먼저 실행

→ 변수나 함수 식별자를 키로 실행 컨텍스트가 관리하는 스코프에 등록

평가 과정이 끝나면 소스코드를 순차 실행

```jsx
var x;
x = 1;
```

소스코드 평가 과정에서

변수 선언문 `var x;`를 먼저 실행하고

식별자 `x`는 실행 컨텍스트가 관리하는 스코프에 등록 후 `undefined`로 초기화된다.

평가가 끝나면 소스코드 실행과정에서 `x =1;`을 실행한다.

이 때 스코프를 통해 `x`의 선언 여부를 확인한 뒤 값을 할당한다.

### 3. 실행 컨텍스트의 역할

1. 전역 코드 평가

전역의 변수와 함수를 전역 스코프에 등록

2. 전역 코드 실행

전역 코드를 순차적으로 실행

3. 함수 코드 평가

함수 호출 시 함수 내부로 진입하여 매개변수와 지역 변수, 지역 함수 선언문이 실행된 뒤, 지역 스코프에 등록된다.

4. 함수 코드 실행

평가과정 후 함수 코드를 순차적으로 실행한다.

→ 위 과정에서 코드 실행 중 **스코프, 식별자, 코드 실행 순서** 등의 관리가 필요하다.

1. 식별자들의 스코프를 구분하여 등록하고 상태 변화 관리
2. 식별자의 스코프 체인 형성
3. 코드 실행 순서 변경

실행 컨턱세트는 소스코드 실행 환경을 제공하고, 그 결과를 관리하는 영역이다.

### 4. 실행 컨텍스트 스택

실행 컨텍스트는 스택 자료구조로 관리되고, 이를 실행 컨텍스트 스택이라고 부른다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/4a11039e-c298-473f-a4f8-6f269a710858/d4885194-2910-4e1a-8844-aa04a55f1fa9/Untitled.png)

실행 컨텍스트 스택을 통해 코드의 실행 순서를 관리한다.

실행 컨텍스트 스택의 최상위에 존재하는 실행 컨텍스트는 언제나 현재 실행 중인 코드의 실행 컨텍스트다.

### 5. 렉시컬 환경

렉시컬 환경은 식별자, 바인딩 값, 상위스코프에 대한 참조를 기록하는 자료구조이다.

렉시컬 환경을 통해 스코프와 식별자를 관리한다.

실행 컨텍스트는

`LexicalEnvironment` 컴포넌트와 `VarialeEnvironment` 컴포넌트로 구성되고,

일반적으로 통일해서 생각할 수 있다.

### 7. 실행 컨텍스트와 블록 레벨 스코프

블록 레벨 스코프를 생성하는 모든 블록문에 대해

코드 블럭이 실행되면 해당 코드 블럭을 위한 블럭 레벨 스코프를 생서해야 한다.

→ 렉시컬 환경을 새롭게 생성해 기존의 전역 렉시컬 환경을 교체한다.

→ 교체된 렉시컬 환경의 외부 렉시컬 환경에 대한 참조는 블럭문 실행 이전 전역 렉시컬 환경을 가리킨다.
